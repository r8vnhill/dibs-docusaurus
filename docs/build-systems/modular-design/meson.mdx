---
title: Modularizando tu proyecto C++ con Meson
---

import GitHubRepoLink from "@site/src/components/git/GitHubRepoLink";
import Explanation from "@site/src/components/admonitions/Explanation";
import BoxedTabs from '@site/src/components/cajitas/BoxedTabs'
import TabItem from '@theme/TabItem'
import Glossary from '@site/src/components/admonitions/Glossary'
import ExcludeFromReadingTime from '@site/src/components/reading-time/ExcludeFromReadingTime'
import ReadingTime from '@site/src/components/reading-time/ReadingTime'

import RepoLinks from '@site/src/components/git/RepoLinks';
import GitLabRepo from '@site/src/components/git/GitLabRepo';
import GitHubRepo from '@site/src/components/git/GitHubRepo';

import TODO from '@site/src/components/TODO/TODO';

import Sh from '@site/src/components/mdx/build-systems/modular-design/meson/sh.mdx'
import CleanupSh from '@site/src/components/mdx/build-systems/modular-design/meson/cleanup-sh.mdx'
import InitializeMultiModuleMesonProjectWindows from '@site/src/components/mdx/build-systems/modular-design/meson/InitializeMultiModuleMesonProjectWindows';

<ReadingTime />
<RepoLinks children={[
    <GitLabRepo user="r8vnhill" repo="echo-app-cpp-meson" />,
    <GitHubRepo user="r8vnhill" repo="echo-app-cpp-meson" />
]} />

{/* #region Introducci√≥n */}
<section title="Introducci√≥n">

<TODO/>

</section>
{/* #endregion Introducci√≥n */}

{/* #region Estructura del proyecto */}
<section title="Estructura del proyecto">

## üèóÔ∏è Estructura esperada del proyecto

```mermaid
graph TD
```

<TODO reason="A√±adir un diagrama de flujo de la estructura del proyecto." />

</section>
{/* #endregion Estructura del proyecto */}

## üì¶ Paso 1: Crear la estructura de carpetas

<TODO/>

<BoxedTabs groupId={"os"}>
  <TabItem value="Windows" label="Windows">
    <InitializeMultiModuleMesonProjectWindows />
  </TabItem>
  <TabItem value="macOS" label="macOS">
      <TODO />
  </TabItem>
  <TabItem value="Ubuntu/Debian" label="Ubuntu/Debian">
      <TODO />
  </TabItem>
</BoxedTabs>

::::tip Limpieza

Puedes borrar los archivos creados en la lecci√≥n pasada o guardarlos como recuerdo.

<BoxedTabs groupId={"os"}>
  <TabItem value="Windows" label="Windows">
    <TODO/>
  </TabItem>
  <TabItem value="macOS" label="macOS">
    <TODO />
  </TabItem>
  <TabItem value="Ubuntu/Debian" label="Ubuntu/Debian">
    <TODO />
  </TabItem>
</BoxedTabs>

::::

## üßæ Paso 2: Declarar el archivo ra√≠z `meson.build`

Este archivo indica a Meson c√≥mo est√° estructurado el proyecto y qu√© subdirectorios contienen partes importantes del sistema, como bibliotecas o ejecutables.  
Se ubica en la ra√≠z del proyecto y es el punto de entrada que Meson usar√° para configurar todo lo dem√°s.

```python showLineNumbers title="meson.build"
project('echo-app', 'cpp', version: '0.2.0')  # Nombre, lenguaje y versi√≥n del proyecto

subdir('src/core')  # Biblioteca reutilizable
subdir('src/app')   # Ejecutable principal
```

:::explanation

Este archivo define la configuraci√≥n general del proyecto: su nombre, el lenguaje principal que utiliza (`cpp`), y su versi√≥n.

Luego, con `subdir(...)`, se incluyen los archivos `meson.build` de los subdirectorios que contienen componentes del sistema.  
Esto permite que cada m√≥dulo (como `core` o `app`) defina su propia configuraci√≥n de forma modular y mantenible.

Al ejecutar `meson setup`, Meson comenzar√° a procesar este archivo y recorrer√° cada subdirectorio en el orden especificado.

:::

:::question

Ejecuta el comando `meson setup build` en la ra√≠z del proyecto. ¬øQu√© sucede? ¬øQu√© pasa si cambias `build` por `buildDir`?

:::

## üß© Paso 3: Implementar la biblioteca `core`

En este paso implementaremos la funcionalidad base de nuestra biblioteca `core`. Esta biblioteca contendr√° una funci√≥n simple llamada `echo`, cuya √∫nica responsabilidad ser√° devolver el mismo texto que recibe.

Primero, declararemos los archivos fuente en `src/core/`:

```cpp showLineNumbers title="src/core/echo.hpp"
#pragma once

#include <string>
#include <string_view>

[[nodiscard]] std::string echo(std::string_view message);
```

```cpp showLineNumbers title="src/core/echo.cpp"
#include "echo.hpp"

std::string echo(std::string_view message) {
    return {message.begin(), message.end()};
}
```

:::explanation

- `echo.hpp` declara la interfaz p√∫blica de la biblioteca. Usamos `#pragma once` para evitar inclusiones m√∫ltiples, `std::string_view` como par√°metro para evitar copias innecesarias, y el atributo `[[nodiscard]]` para advertir si se ignora el valor retornado.
- `echo.cpp` implementa la funci√≥n `echo`, que simplemente convierte el `std::string_view` en un `std::string` para devolver una copia del mensaje.

Este dise√±o es minimalista pero idiom√°tico en C++ moderno: separa declaraci√≥n e implementaci√≥n, y aprovecha tipos livianos y anotaciones que mejoran la seguridad del c√≥digo.

:::


Luego, en el archivo `meson.build` de `src/core/`, definimos c√≥mo compilar esta biblioteca:

```python showLineNumbers title="src/core/meson.build"
core_sources = files('echo.cpp')

core_lib = static_library(
    'core',
    core_sources,
    include_directories: include_directories('.'),
    cpp_args: ['-std=c++23'],
)
```

:::explanation

- `core_sources = files('echo.cpp')`: declaramos los archivos fuente.
- `static_library(...)`: creamos una biblioteca est√°tica llamada `libcore.a` (o su equivalente en tu sistema).
- `include_directories('.')`: permite incluir `echo.hpp` desde otros m√≥dulos.
- `cpp_args`: habilita el est√°ndar de C++ que vamos a utilizar.

:::

:::question

Ejecuta:

```sh
meson setup --reconfigure build
meson compile -C build
```

¬øQu√© sucede? ¬øQu√© archivos se generan en `build/src/core/`?

:::

## üöÄ Paso 4: Implementar el ejecutable principal

<TODO/>

```cpp showLineNumbers title="src/app/main.cpp"
#include <iostream>
#include "echo.hpp"

int main() {
    std::string input;
    std::getline(std::cin, input);

    std::cout << echo(input) << std::endl;
    return 0;
}
```

Luego, definimos c√≥mo compilar este ejecutable en `src/app/meson.build`:

```python showLineNumbers title="src/app/meson.build"
app_sources = files('main.cpp')

executable(
    'echo-app',
    app_sources,
    link_with: core_lib,
    include_directories: include_directories('../core'),
    cpp_args: ['-std=c++23'],
    install: true,
)
```

:::explanation

- `main.cpp` incluye la cabecera de `core` y llama a `echo`, leyendo una l√≠nea por entrada est√°ndar.
- `link_with: core_lib` enlaza el ejecutable con la biblioteca est√°tica que definimos antes.
- `include_directories('../core')` asegura que el compilador pueda encontrar `echo.hpp`.
- `install: true` permite que `ninja install` copie este ejecutable a una ubicaci√≥n del sistema definida por Meson.

:::

:::question

Vuelve a compilar el proyecto y ejecuta el programa con:

```sh
meson compile -C build
./build/src/app/echo-app
```

¬øQu√© ocurre si escribes `hola` y presionas Enter?

:::

```python showLineNumbers title="src/app/meson.build"
app_sources = files('main.cpp')
executable('app', app_sources,
    dependencies: [],
    link_with: core_lib,
    include_directories: include_directories('..')
)
```

C√≥digo principal:

```cpp showLineNumbers title="src/app/main.cpp"
#include <iostream>
#include "core/echo.hpp"

int main() {
    std::cout << echo("Hello from Meson!") << std::endl;
    return 0;
}
```

## üî® Compilaci√≥n

Desde la ra√≠z del proyecto:

```bash
meson setup build
meson compile -C build
```

Y ejecuta el binario:

```bash
./build/src/app/app
```

```plaintext
Echo: Hello from Meson!
```

<Explanation>
El ejecutable `app` se compila en `build/src/app/app` y enlaza con la biblioteca `core`. Gracias a la configuraci√≥n modular, puedes mantener `core` como una unidad reutilizable o independiente.
</Explanation>
